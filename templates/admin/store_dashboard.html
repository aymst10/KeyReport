{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Store Dashboard - KeyReport Analytics{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
.dashboard-container {
    padding: 20px;
    background: #f8f9fa;
    min-height: 100vh;
}

.dashboard-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 10px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.dashboard-header h1 {
    margin: 0;
    font-size: 2.5rem;
    font-weight: 300;
}

.dashboard-header p {
    margin: 10px 0 0;
    opacity: 0.9;
    font-size: 1.1rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-left: 4px solid #667eea;
    transition: transform 0.2s ease;
}

.stat-card:hover {
    transform: translateY(-2px);
}

.stat-card h3 {
    margin: 0 0 10px;
    color: #333;
    font-size: 2rem;
    font-weight: 600;
}

.stat-card p {
    margin: 0;
    color: #666;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat-card.revenue {
    border-left-color: #28a745;
}

.stat-card.orders {
    border-left-color: #007bff;
}

.stat-card.reviews {
    border-left-color: #ffc107;
}

.stat-card.wishlist {
    border-left-color: #dc3545;
}

.content-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.content-card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow: hidden;
}

.card-header {
    background: #f8f9fa;
    padding: 20px;
    border-bottom: 1px solid #dee2e6;
}

.card-header h3 {
    margin: 0;
    color: #333;
    font-size: 1.3rem;
}

.card-body {
    padding: 20px;
}

.table {
    width: 100%;
    border-collapse: collapse;
}

.table th,
.table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #dee2e6;
}

.table th {
    background: #f8f9fa;
    font-weight: 600;
    color: #333;
}

.table tr:hover {
    background: #f8f9fa;
}

.badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 500;
}

.badge-success {
    background: #d4edda;
    color: #155724;
}

.badge-warning {
    background: #fff3cd;
    color: #856404;
}

.badge-info {
    background: #d1ecf1;
    color: #0c5460;
}

.badge-danger {
    background: #f8d7da;
    color: #721c24;
}

.rating-stars {
    color: #ffc107;
    font-size: 1.1rem;
}

.progress-bar {
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
    margin: 5px 0;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea, #764ba2);
    border-radius: 4px;
    transition: width 0.3s ease;
}

@media (max-width: 768px) {
    .content-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .dashboard-header h1 {
        font-size: 2rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>üè™ Store Dashboard</h1>
        <p>Comprehensive analytics and management for KeyReport IT Store</p>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
        <div class="stat-card revenue">
            <h3>{{ monthly_revenue|floatformat:0 }} MAD</h3>
            <p>Monthly Revenue</p>
        </div>
        <div class="stat-card orders">
            <h3>{{ total_orders }}</h3>
            <p>Total Orders</p>
        </div>
        <div class="stat-card reviews">
            <h3>{{ total_reviews }}</h3>
            <p>Product Reviews</p>
        </div>
        <div class="stat-card wishlist">
            <h3>{{ total_wishlist_items }}</h3>
            <p>Wishlist Items</p>
        </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
        <!-- Recent Orders -->
        <div class="content-card">
            <div class="card-header">
                <h3>üì¶ Recent Orders</h3>
            </div>
            <div class="card-body">
                {% if recent_orders %}
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Order #</th>
                                <th>Customer</th>
                                <th>Status</th>
                                <th>Total</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in recent_orders %}
                            <tr>
                                <td>{{ order.order_number }}</td>
                                <td>{{ order.customer.get_full_name|default:order.customer.email }}</td>
                                <td>
                                    <span class="badge badge-{{ order.get_status_class }}">
                                        {{ order.get_status_display }}
                                    </span>
                                </td>
                                <td>{{ order.total_amount }} MAD</td>
                                <td>{{ order.created_at|date:"M d, Y" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>No recent orders found.</p>
                {% endif %}
            </div>
        </div>

        <!-- Review Statistics -->
        <div class="content-card">
            <div class="card-header">
                <h3>‚≠ê Review Statistics</h3>
            </div>
            <div class="card-body">
                <div style="margin-bottom: 20px;">
                    <strong>Total Reviews:</strong> {{ review_stats.total }}<br>
                    <strong>Approved:</strong> {{ review_stats.approved }}<br>
                    <strong>Pending:</strong> {{ review_stats.pending }}<br>
                    <strong>Average Rating:</strong> 
                    <span class="rating-stars">
                        {% for i in "12345" %}
                            {% if forloop.counter <= review_stats.avg_rating %}
                                ‚òÖ
                            {% else %}
                                ‚òÜ
                            {% endif %}
                        {% endfor %}
                    </span>
                    ({{ review_stats.avg_rating|floatformat:1 }})
                </div>
                
                {% if recent_reviews %}
                    <h4>Recent Reviews</h4>
                    {% for review in recent_reviews %}
                        <div style="border-bottom: 1px solid #eee; padding: 10px 0;">
                            <strong>{{ review.product.name|truncatechars:30 }}</strong><br>
                            <span class="rating-stars">
                                {% for i in "12345" %}
                                    {% if forloop.counter <= review.rating %}
                                        ‚òÖ
                                    {% else %}
                                        ‚òÜ
                                    {% endif %}
                                {% endfor %}
                            </span>
                            by {{ review.user.email }}<br>
                            <small>{{ review.created_at|date:"M d, Y" }}</small>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Top Products and Categories -->
    <div class="content-grid">
        <!-- Top Products -->
        <div class="content-card">
            <div class="card-header">
                <h3>üèÜ Top Selling Products</h3>
            </div>
            <div class="card-body">
                {% if top_products %}
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Category</th>
                                <th>Sold</th>
                                <th>Rating</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in top_products %}
                            <tr>
                                <td>{{ product.name|truncatechars:30 }}</td>
                                <td>{{ product.category.name }}</td>
                                <td>{{ product.total_sold|default:0 }}</td>
                                <td>
                                    <span class="rating-stars">
                                        {% for i in "12345" %}
                                            {% if forloop.counter <= product.average_rating %}
                                                ‚òÖ
                                            {% else %}
                                                ‚òÜ
                                            {% endif %}
                                        {% endfor %}
                                    </span>
                                    ({{ product.average_rating|floatformat:1 }})
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>No sales data available.</p>
                {% endif %}
            </div>
        </div>

        <!-- Category Distribution -->
        <div class="content-card">
            <div class="card-header">
                <h3>üìä Category Distribution</h3>
            </div>
            <div class="card-body">
                {% for category in category_stats %}
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <strong>{{ category.name }}</strong>
                            <span>{{ category.product_count }} products</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {% widthratio category.product_count total_products 100 %}%"></div>
                        </div>
                        {% if category.avg_rating %}
                            <small>Avg Rating: 
                                <span class="rating-stars">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= category.avg_rating %}
                                            ‚òÖ
                                        {% else %}
                                            ‚òÜ
                                        {% endif %}
                                    {% endfor %}
                                </span>
                                ({{ category.avg_rating|floatformat:1 }})
                            </small>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Order Status Distribution -->
    <div class="content-card">
        <div class="card-header">
            <h3>üìà Order Status Distribution</h3>
        </div>
        <div class="card-body">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                {% for stat in order_status_stats %}
                    <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <h4 style="margin: 0 0 10px; color: #333;">{{ stat.count }}</h4>
                        <p style="margin: 0; color: #666; text-transform: uppercase; font-size: 0.9rem;">
                            {{ stat.status|title }}
                        </p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}







